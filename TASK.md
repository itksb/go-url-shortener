# Задание для трека «Сервис сокращения URL»

## Напишите сервис для сокращения длинных URL. Требования:

- Сервер должен быть доступен по адресу: http://localhost:8080.
- Сервер должен предоставлять два эндпоинта: POST / и GET /{id}.
- Эндпоинт POST / принимает в теле запроса строку URL для сокращения и возвращает ответ с кодом 201 и сокращённым URL в
  виде текстовой строки в теле.
- Эндпоинт GET /{id} принимает в качестве URL-параметра идентификатор сокращённого URL и возвращает ответ с кодом 307 и
  оригинальным URL в HTTP-заголовке Location.
- Нужно учесть некорректные запросы и возвращать для них ответ с кодом 400.

## Инкремент 4 Задание для трека «Сервис сокращения URL»

- Добавьте в сервер новый эндпоинт POST /api/shorten, принимающий в теле запроса JSON-объект {"url":"<some_url>"} и
  возвращающий в ответ объект {"result":"<shorten_url>"}.
- Не забудьте добавить тесты на новый эндпоинт, как и на предыдущие.
- Помните про HTTP content negotiation, проставляйте правильные значения в заголовок Content-Type.

## Инкремент 5 Задание для трека «Сервис сокращения URL»

Добавьте возможность конфигурировать сервис с помощью переменных окружения:

- адрес запуска HTTP-сервера с помощью переменной SERVER_ADDRESS.
- базовый адрес результирующего сокращённого URL с помощью переменной BASE_URL.

## Инкремент 6 Задание для трека «Сервис сокращения URL»

- Сохраняйте все сокращённые URL на диск в виде файла. При перезапуске приложения все URL должны быть восстановлены.
- Путь до файла должен передаваться в переменной окружения FILE_STORAGE_PATH.
- При отсутствии переменной окружения или при её пустом значении вернитесь к хранению сокращённых URL в памяти.

## Инкремент 7 Задание для трека «Сервис сокращения URL»

Поддержите конфигурирование сервиса с помощью флагов командной строки наравне с уже имеющимися переменными окружения:

- флаг -a, отвечающий за адрес запуска HTTP-сервера (переменная SERVER_ADDRESS);
- флаг -b, отвечающий за базовый адрес результирующего сокращённого URL (переменная BASE_URL);
- флаг -f, отвечающий за путь до файла с сокращёнными URL (переменная FILE_STORAGE_PATH).

## Инкремент 8 Задание для трека «Сервис сокращения URL»

Добавьте поддержку gzip в ваш сервис. Научите его:

- принимать запросы в сжатом формате (HTTP-заголовок Content-Encoding);
- отдавать сжатый ответ клиенту, который поддерживает обработку сжатых ответов (HTTP-заголовок Accept-Encoding).
- Вспомните middleware из урока про HTTP-сервер, это может вам помочь.

## Инкремент 9 Задание для трека «Сервис сокращения URL»

Добавьте в сервис функциональность аутентификации пользователя.

Сервис должен:

- Выдавать пользователю симметрично подписанную куку, содержащую уникальный идентификатор пользователя, если такой куки
  не
  существует или она не проходит проверку подлинности.
- Иметь хендлер GET /api/user/urls, который сможет вернуть пользователю все когда-либо сокращённые им URL в формате:

```json
[
  {
	"short_url": "http://...",
	"original_url": "http://..."
  }
]
```

При отсутствии сокращённых пользователем URL хендлер должен отдавать HTTP-статус 204 No Content.

Получить куки запроса можно из поля  ``(*http.Request).Cookie``, а установить — методом ``http.SetCookie``.

## Инкремент 10 Задание для трека «Сервис сокращения URL»

- Добавьте в сервис функциональность подключения к базе данных. В качестве СУБД используйте PostgreSQL не ниже 10
  версии.
- Добавьте в сервис хендлер GET /ping, который при запросе проверяет соединение с базой данных. При успешной проверке
  хендлер должен вернуть HTTP-статус 200 OK, при неуспешной — 500 Internal Server Error.
- Строка с адресом подключения к БД должна получаться из переменной окружения DATABASE_DSN или флага командной строки
  -d.


## Инкремент 11 - Задание для трека «Сервис сокращения URL»

- Перепишите сервис так, чтобы СУБД PostgreSQL стала хранилищем сокращённых URL вместо текущей реализации.
- Сервису нужно самостоятельно создать все необходимые таблицы в базе данных. Схема и формат хранения остаются на ваше усмотрение.
- При отсутствии переменной окружения DATABASE_DSN или флага командной строки -d или при их пустых значениях вернитесь последовательно к:


- хранению сокращённых URL в файле при наличии соответствующей переменной окружения или флага командной строки;
- хранению сокращённых URL в памяти.
